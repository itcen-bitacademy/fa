<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="menu51">
	
	<select id="selectAllCount" resultType="int" parameterType="ldebtvo">
	<![CDATA[
		select count(*)
		    from tb_p_debt
		    where delete_flag= "N"
	]]>
			<if  test="debtDate!=null and !debtDate.equals('')">		    
			<![CDATA[
			and 	date_format(debt_date,'%Y-%m-%d') like concat('%',#{debtDate},'%') 
			]]>
			</if>
			<if test="intPayWay != null and !intPayWay.equals('')">
			<![CDATA[
			and 	int_pay_way = #{intPayWay} 
			]]>
			</if>
		     <if test="bankCode != null and !bankCode.equals('')">		    
			<![CDATA[
			and 	bank_code like concat('%',#{bankCode},'%') 
			]]>
			</if>
			<if test="expDate != null and !expDate.equals('')">
			<![CDATA[
			and 	date_format(exp_date,'%Y-%m-%d') like concat('%',#{expDate},'%') 
			]]>
			</if>
	</select>
	
	<!-- select list -->
	<select id="selectAll" resultType="ldebtvo" parameterType="map">
	<![CDATA[
		select 
			   	  a.no as no,
		          a.code as code,
		          a.name as name,
		          a.major_code as majorCode,
		          a.debt_amount as debtAmount,
		          a.repay_bal as repayBal,
		          a.repay_way as repayWay,
		          concat(date_format(a.debt_date,'%Y-%m-%d'), ' - ', date_format(a.exp_date,'%Y-%m-%d')) as debtExpDate,
		          a.int_rate as intRate,
		          a.int_pay_way as intPayWay,
		          a.mgr,
		          a.mgr_call as mgrCall, a.danger_code as dangerCode, a.danger_name as dangerName, 
		          a.bank_code as bankCode,
		          a.deposit_no as depositNo,
		          b.name as bankName
		          from tb_p_debt as a,tb_bank as b
		          where a.bank_code = b.code
		                and a.delete_flag = 'N'
		    ]]>
		  <if  test="debtDate!=null and !debtDate.equals('')">		    
			<![CDATA[
			and 	date_format(a.debt_date,'%Y-%m-%d') like concat('%',#{vo.debtDate},'%') 
			]]>
			</if>
			<if test="intPayWay != null and !intPayWay.equals('')">
			<![CDATA[
			and 	a.int_pay_way = #{vo.intPayWay}
			]]>
			</if>
		     <if test="bankCode != null and !bankCode.equals('')">		    
			<![CDATA[
			and 	a.bank_code like concat('%',#{vo.bankCode},'%') 
			]]>
			</if>
			<if test="expDate != null and !expDate.equals('')">
			<![CDATA[
			and 	date_format(a.exp_date,'%Y-%m-%d') like concat('%',#{vo.expDate},'%') 
			]]>
			</if>
			
			<if test="sort != null and sort.equals('d')">
			<![CDATA[
				order by a.debt_date 
			]]>
			</if>
			<if test="sort != null and sort.equals('e')">
			<![CDATA[
				order by a.exp_date
			]]>
			</if>
		     <if test="sort != null and sort.equals('i')">		    
			<![CDATA[
				order by a.insert_date
			]]>
			</if>
			<if test="sort != null and sort.equals('m')">
			<![CDATA[
				order by a.debt_amount
			]]>
			</if>
			<if test="pagination.pageIndex >= 0">
            <![CDATA[
                limit #{pagination.pageIndex }, #{pagination.listSize }
             ]]>
          </if>
	</select>
	
	<select id="selectsection" resultType="sectionvo">
		<![CDATA[
			select no,
				classification,
				code,
				last_update as lastUpdate,
				parent_no as parentNo
			    from tb_section
			    where parent_no= 6
		]]>
	</select>

</mapper>