<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="menu56">
	<!-- Team -->
	<insert id="save" parameterType="test12vo">
		<![CDATA[
		insert
		  into test
		values (null, #{name })
		]]>
		<selectKey keyProperty="no" resultType="long" order="AFTER">
			<![CDATA[
			select last_insert_id()
			]]>
		</selectKey>
	</insert>
	
	<select id="getList" resultType="currentsituationvo">
	<![CDATA[
	select sales.section_code as sectioncode,sales.section_name as sectionname,sales.item_code as itemcode,sales.item_name as itemname,
			purchasemanagement.quantity as purchasemanagementquantity, purchasemanagement.sum_supply_value as purchasemanagementsupplyvalue,
			purchasemanagement.sum_tax_value as purchasemanagementtaxvalue,purchasemanagement.total_price as purchasemanagementtotalprice,
	        sales.quantity as salesquantity,sales.sum_supply_value as salessupplyvalue,sales.sum_tax_value as salestaxvalue,sales.total_price as salestotalprice,
	        purchasemanagement.quantity - sales.quantity as stockquantity,
	        (purchasemanagement.quantity - sales.quantity)*(purchasemanagement.tax_value+purchasemanagement.supply_value) as stocktotalprice,
	        (purchasemanagement.quantity-sales.quantity)*purchasemanagement.tax_value as stocktaxvalue
	from (select section_code,section_name,item_code,item_name,
				sum(quantity)as quantity,sum(total_price)as total_price,
	            sum(tax_value)as sum_tax_value,tax_value,
	            sum(supply_value) as sum_supply_value, supply_value
			from tb_purchasemanagement_test
			group by item_code)as purchasemanagement,
		 (select section_code,section_name,item_code,item_name,
				sum(quantity)as quantity,sum(total_price)as total_price,
	            sum(tax_value)as sum_tax_value,tax_value,
	            sum(supply_value) as sum_supply_value, supply_value
			from tb_sales_test
			group by item_code)as sales
	where purchasemanagement.item_code=sales.item_code;
	]]>
	</select>
	
	
	<!-- 대분류 목록을 가져오는 코드  -->
	<!-- sectionvo의 경우 admin사용 하기 위해 만들어준 객체를 사용 -->
	<select id="getmaincategory" resultType="sectionvo">
		   select classification, code, no
    	   from tb_section
    	   where parent_no is null;
	</select>
	
	<!-- 분류 목록을 가져오는 코드  -->
	<!-- sectionvo의 경우 admin사용 하기 위해 만들어준 객체를 사용 -->
	<select id="getsubcategory" resultType="sectionvo" parameterType="int">
		select classification, code, no
		from tb_section
		where parent_no = #{no };
	</select>

</mapper>