<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="menu33">
	<!-- Team -->
	<insert id="purchaseitemadd" parameterType="purchaseitem33vo">
		<![CDATA[
		insert into tb_purchaseitem(no, name, price, produce_date, purpose, standard, section_code, factory_code, insert_userid, insert_day)
							 values(#{no }, #{name }, #{price }, #{producedate }, #{purpose }, #{standard }, #{sectioncode }, #{factorycode }, #{insertuserid }, now())
		]]>
	</insert>
	
	<select id="factorycodeselect" resultType="int">
		<![CDATA[
		select count(*) from tb_factory
		]]>
	</select>
	
	<insert id="factoryadd" parameterType="factory33vo">
		<![CDATA[
		insert into tb_factory(no, name, postaddress, roadaddress, detailaddress, manager_name, insert_userid, insert_day)
					   	select #{no }, #{name }, #{postaddress }, #{roadaddress }, #{detailaddress }, #{managername }, #{insertuserid }, now()
							from dual where not exists
							(select * from tb_factory where name = #{name } and delete_flag = "N")
		]]>
	</insert>
	
	<update id="purchaseitemupdate" parameterType="purchaseitem33vo">
		<![CDATA[
		update tb_purchaseitem set name = #{name }, price = #{price }, produce_date = #{producedate }, purpose = #{purpose }, standard = #{standard }, section_code = #{sectioncode }, factory_code = #{factorycode }, update_userid = #{updateuserid }, update_day = now()
							 where no = #{no }
		]]>
	</update>
	
	<update id="factoryupdate" parameterType="factory33vo">
		<![CDATA[
		update tb_factory set name = #{name }, postaddress = #{postaddress }, roadaddress = #{roadaddress }, detailaddress = #{detailaddress }, manager_name = #{managername }, update_userid = #{updateuserid }, update_day = now()
						where no = #{no }
		]]>
	</update>
	
	<update id="purchaseitemdelete" parameterType="purchaseitem33vo">
		<![CDATA[
		update tb_purchaseitem set delete_flag = "Y", update_userid = #{updateuserid }, update_day = now() where no = #{no }
		]]>
	</update>
	
	<update id="factorydelete" parameterType="factory33vo">
		<![CDATA[
		update tb_factory set delete_flag = "Y", update_userid = #{updateuserid }, update_day = now() where no = #{no }
		]]>
	</update>
	
	<select id="searchpurchaseitem" parameterType="String" resultType="purchaseitem33vo">
		<![CDATA[
		select no, name, price, date(produce_date) as producedate, purpose, standard, section_code as sectioncode, factory_code as factorycode from tb_purchaseitem where no = #{no } and delete_flag = "N"
		]]>
	</select>
	
	<select id="searchfactory" parameterType="String" resultType="factory33vo">
		<![CDATA[
		select no, name, postaddress, roadaddress, detailaddress, manager_name as managername from tb_factory where no = #{no } and delete_flag = "N"
		]]>
	</select>
	
	<select id="searchfactorycode" parameterType="String" resultType="String">
		<![CDATA[
		select no from tb_factory where no = (select factory_code from tb_purchaseitem where no = #{no })
		]]>
	</select>
	
	<select id="searchsection" parameterType="String" resultType="sectionvo">
		<![CDATA[
		select no, classification, code, last_update as lastUpdate, parent_no as parentNo from tb_section where parent_no = 1 and code = #{no }
		]]>
	</select>
	
	<select id="getpurchaseitemlist" resultType="purchaseitem33vo">
		<![CDATA[
		select p.no, p.name, p.price, date(p.produce_date) as producedate, p.section_code as sectioncode, p.standard, s.classification as sectionname, f.manager_name as managername
		  from tb_purchaseitem p, tb_factory f, tb_section s
		 where p.section_code = s.code and p.factory_code = f.no and s.parent_no = 1 and p.delete_flag = "N"
		 order by p.idx asc;
		]]>
	</select>
	
	<select id="getsectionlist" resultType="sectionvo">
		<![CDATA[
		select no, classification, code, last_update as lastUpdate, parent_no as parentNo from tb_section where parent_no = 1
		]]>
	</select>
	
	<select id="getsearchsectionlist" parameterType="String" resultType="sectionvo">
		<![CDATA[
		select no, classification, code, last_update as lastUpdate, parent_no as parentNo from tb_section where parent_no = 1 and classification like #{sectionname }
		]]>
	</select>
</mapper>




