<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="menu27">

	<!-- Test -->
	<insert id="save" parameterType="test1vo">
		<![CDATA[
		insert
		  into test
		values (null, #{name })
		]]>
		<selectKey keyProperty="no" resultType="long" order="AFTER">
			<![CDATA[
			select last_insert_id()
			]]>
		</selectKey>
	</insert>
	
	<!-- 리스트 뽑기 -->
	<select id="getList" parameterType="map" resultType="1customervo">
		<![CDATA[
			select substr(no,2) as no,
     			   name as name, 
       			   ceo as ceo, 
			       address as address,
			       detail_address as detailAddress,
			       conditions as conditions, 
			       item as item, 
			       corporation_no as corporationNo, 
			       open_date as openDate, 
			       jurisdiction_office as jurisdictionOffice, 
			       phone as phone, 
			       manager_name as managerName, 
			       manager_email as managerEmail,
			       assets_flag as assetsFlag,
			       deposit_no as depositNo,
			       deposit_host as depositHost,
			       bank_code as bankCode,
			       bank_name as bankName,
			       insert_userid as insertUserid, 
			       insert_day as insertDay, 
			       update_userid as updateUserid, 
			       update_day as updateDay
			  from tb_customer
			 where delete_flag = 'N'
			   and name!='여비'
		]]>
		<if test="pagination.pageIndex >= 0 ">
			<![CDATA[
				 limit #{pagination.pageIndex }, #{pagination.listSize }
			]]>
		</if>
	</select>
	
	<!-- 거래처 입력 -->
	<insert id="create" parameterType="1customervo">
		<![CDATA[
			insert 
			  into tb_customer 
			values (concat('A' ,#{no}),
				   #{name },
				   #{ceo }, 
				   #{address }, 
				   #{detailAddress }, 
				   #{conditions }, 
				   #{item }, 
				   #{corporationNo }, 
				   now(), 
				   #{jurisdictionOffice }, 
				   #{phone }, 
				   #{managerName }, 
				   #{managerEmail }, 
				   #{depositNo}, 
				   #{depositHost },
				   #{bankCode },
				   #{bankName },
				   'N', 
				   #{assetsFlag }, 
				   #{insertUserid }, 
				   now(), 
				   null, 
				   null)
		]]>
	</insert>
	
	<!-- 거래처 검색(사업자등록번호로) -->
	<select id="read" parameterType="1customervo" resultType="1customervo">
		<![CDATA[
			select substr(no,2) as no,
     			   name as name, 
       			   ceo as ceo, 
			       address as address,
			       detail_address as detailAddress,
			       conditions as conditions, 
			       item as item, 
			       corporation_no as corporationNo, 
			       open_date as openDate, 
			       jurisdiction_office as jurisdictionOffice, 
			       phone as phone, 
			       manager_name as managerName, 
			       manager_email as managerEmail,
			       deposit_no as depositNo,
			       deposit_host as depositHost,
			       bank_code as bankCode,
			       bank_name as bankName,
			       assets_flag as assetsFlag,
			       insert_userid as insertUserid,
			       insert_day as insertDay, 
			       update_userid as updateUserid
			  from tb_customer
			 where delete_flag = "N"
			   and name!='여비'
			   and no like '%${no }%'
		]]>
	</select>
	
	<!-- 거래처 수정 -->
	<update id="update" parameterType="1customervo">
		<![CDATA[
			update tb_customer
			   set no = concat('A' ,#{no }),
				   name = #{name },
				   ceo = #{ceo },
				   address = #{address }, 
				   detail_address = #{detailAddress },
				   conditions = #{conditions },
				   item = #{item },
				   corporation_no = #{corporationNo },
				   jurisdiction_office = #{jurisdictionOffice},
				   phone = #{phone },
				   manager_name = #{managerName },
				   manager_email = #{managerEmail },
				   deposit_no = #{depositNo },
				   deposit_host = #{depositHost },
				   bank_code = #{bankCode },
				   bank_name = #{bankName },
				   assets_flag = #{assetsFlag },
				   update_userid = #{updateUserid },
				   update_day = now()
			 where no = concat('A', #{no})
			   and name!='여비'
		]]>
	</update>
	
	<!-- 거래처 삭제 (flag N->Y)-->
	<update id="delete" parameterType="1customervo">
		<![CDATA[
			update tb_customer
			   set delete_flag = 'Y'
			 where name =  #{name }
			   and name!='여비'
		]]>
	</update>
	
	<!-- 거래처 전체삭제 -->
	<delete id = "deleteAll" parameterType="1customervo">
		<![CDATA[
			delete from tb_customer
			 where no = concat('A', #{no})
			   and delete_flag = "Y";
		]]>
	</delete>
	
	<select id="getCount" resultType="int">
		<![CDATA[
		select	count(*)
		 from	tb_customer 
		 where	delete_flag = "N"
		   and  name!='여비'
		]]>
	</select>
	
</mapper>