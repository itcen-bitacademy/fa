<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="menu10">

	<!--  TEST -->
	<insert id="save" parameterType="test08vo">
		<![CDATA[
		insert
		  into test
		values (null, #{name })
		]]>
		<selectKey keyProperty="no" resultType="long" order="AFTER">
			<![CDATA[
			select last_insert_id()
			]]>
		</selectKey>
	</insert>


	<select id="getList" parameterType="map" resultType="08landvo">
		<![CDATA[
			select a.id, a.customer_no as customerNo, c.name as customerName, c.manager_name as managerName, a.taxbill_no as taxbillNo, a.voucher_no as voucherNo,
				a.section_no as sectionNo, b.classification as sectionName, a.land_area as landArea, a.combine_no as combineNo, a.owner_name as ownerName, 
				a.wide_address as wideAddress,
				a.city_address as cityAddress,
				a.detail_address as detailAddress,
				a.public_value as publicValue,
				a.acq_price as acqPrice,
				a.etc_cost as etcCost,
				a.reg_tax as regTax,
				a.acq_tax as acqTax,
				a.pay_date as payDate,
				a.tax_kind as taxKind,
				a.flag as flag
			from tb_land a, tb_section b, tb_customer c 
			where a.section_no = b.code and b.parent_no=2  
			and a.customer_no = c.no and c.assets_flag="a" 
			]]>
				<if test='id!=null'>
				<![CDATA[
					 and a.id like #{id}
				]]>
				</if>
				<if test='sectionName!=""'>
				<![CDATA[
					 and b.classification = #{sectionName }
				]]>
				</if>	
				<if test='payDate!=""'>
				<![CDATA[
					and a.pay_date >= '${startDate } 00:00:00' and a.pay_date <= '${endDate } 23:59:59'
				]]>
				</if>
				<if test='customerName!=""'>
				<![CDATA[
					 and b.name like #{customerName }
				]]>
				</if>
				<if test='managerName!=""'>
				<![CDATA[
					 and c.manager_name like #{managerName }
				]]>
				</if>
				<if test='landArea!=0'>
				<![CDATA[
					 and a.land_area <= #{landArea }
				]]>
				</if>
				<if test='wideAddress!=""'>
				<![CDATA[
					 and a.wide_address = #{wideAddress }
				]]>
				</if>
				<if test='cityAddress!=""'>
				<![CDATA[
					 and a.wide_address = #{cityAddress }
				]]>
				</if>
				<if test='acqPrice!=null and acqPrice!=0'>
				<![CDATA[
					 and a.acq_price <= #{acqPrice }
				]]>
				</if>
	</select>
	
	<select id="selectList" parameterType="map" resultType="08landvo">
		<![CDATA[
			select id, customer_no as customerNo, tb_customer.name as customerName, tb_customer.manager_name as managerName, taxbill_no as taxbillNo, voucher_no as voucherNo,
				   section_no as sectionNo, classification as sectionName, land_area as landArea, combine_no as combineNo, owner_name as ownerName, 
                   wide_address as wideAddress,
                   city_address as cityAddress,
                   tb_land.detail_address as detailAddress,
                   public_value as publicValue,
                   acq_price as acqPrice,
                   etc_cost as etcCost,
                   reg_tax as regTax,
                   acq_tax as acqTax,
				   pay_date as payDate,
				   tax_kind as taxKind, 
				   flag,
				   tb_land.insert_userid as insertUserid,
				   tb_land.insert_day as insertDay,
				   tb_land.update_userid as updateUserid, 
				   tb_land.update_day as updateDay
			  from tb_land left outer join tb_section on tb_land.section_no=tb_section.code 
			left outer join tb_customer on tb_land.customer_no=tb_customer.no
			where tb_section.parent_no=2
		]]>
	</select>
	
	
	<!-- 페이징 처리  -->
	 <select id="list" resultType="08landvo" parameterType="map">
		<![CDATA[
			select id, customer_no as customerNo, tb_customer.name as customerName, tb_customer.manager_name as managerName, taxbill_no as taxbillNo, voucher_no as voucherNo,
				   section_no as sectionNo, classification as sectionName, land_area as landArea, combine_no as combineNo, owner_name as ownerName, 
                   wide_address as wideAddress,
                     city_address as cityAddress,
                     tb_land.detail_address as detailAddress,
                     public_value as publicValue,
                     acq_price as acqPrice,
                     etc_cost as etcCost,
                     reg_tax as regTax,
                     acq_tax as acqTax,
					 pay_date as payDate,
					 tax_kind as taxKind, 
					 flag,
					 tb_land.insert_userid as insertUserid,
					 tb_land.insert_day as insertDay,
					 tb_land.update_userid as updateUserid, 
					 tb_land.update_day as updateDay
			from tb_land left outer join tb_section on tb_land.section_no=tb_section.code 
			left outer join tb_customer on tb_land.customer_no=tb_customer.no 
			where tb_section.parent_no=2 and tb_land.insert_day> (NOW() - INTERVAL 3 DAY)
             and flag IN('s','o')
		]]>
		<if test="id>0"><!-- "_parameter.length()>0" --> 
            <![CDATA[
              and id like concat('%',#{id },'%') 
            ]]>
         </if>
         <![CDATA[
          order by tb_land.update_day asc, tb_land.insert_day asc
         ]]>
         <if test="pagination.pageIndex >= 0">
			<![CDATA[
        		limit #{pagination.pageIndex }, #{pagination.listSize }
    		]]>
		</if>
	</select> 
	
</mapper>