<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="menu41">

	<!--  TEST -->
	<insert id="save" parameterType="test08vo">
		<![CDATA[
		insert
		  into test
		values (null, #{name })
		]]>
		<selectKey keyProperty="no" resultType="long" order="AFTER">
			<![CDATA[
			select last_insert_id()
			]]>
		</selectKey>
	</insert>
	
	<!-- 대분류 리스트 TEST -->
	<select id="section"  resultType="sectionvo">
		<![CDATA[
		select no as no,
			   code as code,
			   classification as classification
		from tb_section
		where parent_no = 4;  
		]]>
	</select>
	
	<!-- 직급 리스트 TEST -->
	<select id="name"  resultType="name">
		<![CDATA[
		select no, staff_name as staffName from tb_staff;
		]]>
	</select>
	
	
	<!-- 등록 TEST -->
	<insert id="insert" parameterType="vehicle08vo">
		<![CDATA[
		insert
		  into tb_vehicle
		values (#{id },null,null,null,#{sectionNo},#{staffNo},#{ownerName},null,null,null,null,#{publicValue},#{regTax},#{acqTax},#{etcCost}, #{payDate}, #{deposit},
				#{depositDate}, #{monthlyFee}, #{feeDate}, #{taxKind}, "s", null, curdate(), null, null);
		]]>
		<selectKey keyProperty="id" resultType="string" order="AFTER">
			<![CDATA[
			select last_insert_id()
			]]>
		</selectKey>
	</insert>
	
	<!-- 등록된거 조회 리스트 TEST -->
	<select id="select"  resultType="vehicle08vo">
		<![CDATA[
		select  	v.id as id,
					v.section_no as sectionNo,
					s.classification as classification,
					st.staff_name as staffName,
					v.owner_name as ownerName,
					v.public_value as publicValue,
					v.reg_tax as regTax,
					v.acq_tax as acqTax,
					v.etc_cost as etcCost,
					v.pay_date as payDate,
					v.deposit as deposit,
					v.deposit_date as depositDate,
					v.monthly_fee as monthlyFee,
					v.fee_date as feeDate,
					v.tax_kind as taxKind,
					v.insert_day as insertDay
		from tb_vehicle v 
				 left outer join tb_staff st on v.staff_no = st.no
				 left outer join tb_section s on v.section_no = s.code 
		where s.parent_no=4 and v.insert_day > (NOW() - INTERVAL 3 DAY) and flag="s";
		]]>
	</select>
	
	
	<!-- 수정 TEST --><!-- where 조건절에 행이 선택되어있을경우 set flag="d"로 바꾸고 -->
	<update id="update" parameterType="vehicle08vo">
		<![CDATA[
		update tb_vehicle
		  set id = #{id },
		  	  customer_no = null,
		  	  taxbill_no = null,
		  	  voucher_no = null,
		  	  section_no = null,
		  	  staff_no = #{staffNo},
	  	  	  staff_name = #{staffName},
		  	  owner_name = #{ownerName},
		  	  wide_address = null,
		  	  city_address = null,
		  	  local_address = null,
		  	  detail_address = null,
		  	  public_value = #{publicValue},
		  	  reg_tax = #{regTax},
		  	  acq_tax = #{acqTax},
		  	  etc_cost = #{etcCost},
		  	  pay_date = #{payDate},
		  	  deposit =  #{deposit},
			  deposit_date = #{depositDate},
			  monthly_fee = #{monthlyFee},
			  fee_date = #{feeDate},
			  tax_kind = #{taxKind},
			  flag = "o",
			  update_userid = null,
			  update_day = curdate()
	    where flag="s"
	    	and id = #{id }; 
		]]>
	</update>
 
	
	<!-- 삭제 TEST --><!--  삭제버튼 클릭시 flag="s"를 flag="d"로 바꾸면서 삭제-->

	<update id="delete" parameterType="string">
		<![CDATA[
		update tb_vehicle
		  set flag="d"
	    where id=#{id}; 
		]]>
	</update>
 
 
 	<!-- 검색  TEST -->
	<select id="search"  resultType="vehicle08vo">
		<![CDATA[
		select  v.id as id,
				s.staff_name as staffName,
				pay_date as payDate,
				deposit as deposit,
				deposit_date as depositDate,
				monthly_fee as monthlyFee,
				fee_date as feeDate 
		from tb_vehicle v left outer join tb_staff s 
	    on v.staff_no = s.no ;
		]]>
	</select>
	
</mapper>