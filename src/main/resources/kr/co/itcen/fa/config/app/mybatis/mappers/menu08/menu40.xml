<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="menu40">
	
	<!-- 조회 -->
	<select id="list" resultType="building08vo" parameterType="map">
		<![CDATA[
		select id,
			customer_no as customerNo,
			name as customerName,
			manager_name as managerName,
			taxbill_no as taxbillNo,
			voucher_no as voucherNo,
			section_no as sectionNo,
            classification as sectionName,
			area,
			combine_no as combineNo,
			owner_name as ownerName,
			wide_address as wideAddress,
			city_address as cityAddress,
			b.detail_address as detailAddress,
			floor,
			basement,
			purpose,
			material,
			public_value as publicValue,
			acq_price as acqPrice,
			etc_cost as etcCost,
			acq_tax as acqTax,
			pay_date as payDate,
			tax_kind as taxKind,
			b.flag,
			b.insert_userid as insertUserid,
			b.insert_day as insertDay
		from tb_building as b left outer join tb_section on b.section_no = tb_section.code
			               left outer join tb_customer on b.customer_no = tb_customer.no
        where tb_section.parent_no = 3 
           and b.flag = 's'
           and b.pay_date like concat('%',#{vo.id },'%')
           and b.customer_no like concat('%',#{vo.customerNo },'%')
           and b.area like concat('%',#{vo.area },'%')
           and b.section_no like concat('%',#{vo.sectionNo },'%')
           and b.wide_address like concat('%',#{vo.wideAddress },'%')
           and b.city_address like concat('%',#{vo.cityAddress },'%')
           and b.detail_address like concat('%',#{vo.detailAddress },'%')
           and b.acq_price like concat('%',#{vo.acqPrice },'%')
           
		]]>
   		<![CDATA[	
		order by b.insert_day desc
		]]>
		<if test="pagination.pageIndex >= 0">
			<![CDATA[
        		limit #{pagination.pageIndex }, #{pagination.listSize }
    		]]>
		</if>
	</select>
	
	<!-- 대분류 -->
	<select id="getSection" resultType="sectionvo">
		<![CDATA[
		select no,
			classification,
			code,
			last_update as lastUpdate,
			parent_no as parentNo
		from tb_section
		where parent_no = 3
		]]>
	</select>
	
	<!-- 거래처 -->
	<select id="getCustomer" resultType="1customervo">
		<![CDATA[
		select no, 
			name,
			manager_name as managerName
		from tb_customer
		]]>
	</select>
	
	<select id="pageCount" resultType="int" parameterType="building08vo">
		select count(*)
		from tb_building
	</select>
</mapper>