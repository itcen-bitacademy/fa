<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="menu49">
	<!-- Team -->
	<insert id="save" parameterType="test4vo">
		<![CDATA[
		insert
		  into test
		values (null, #{name })
		]]>
		<selectKey keyProperty="no" resultType="long" order="AFTER">
			<![CDATA[
			select last_insert_id()
			]]>
		</selectKey>
	</insert>
	<select id="selectAllCount" resultType="int" parameterType="ldebtvo">
	<![CDATA[
		select count(*)
		    from tb_l_term_debt
		    where delete_flag= "N"
	]]>
			 <if  test='debtDate!=null and !"".equals(debtDate)'>		    
			<![CDATA[
			and 	date_format(debt_date,'%Y-%m-%d') like concat('%',#{debtDate},'%') 
			]]>
			</if>
			<if test='intPayWay != null and !"".equals(intPayWay)'>
			<![CDATA[
			and 	int_pay_way = #{intPayWay}
			]]>
			</if>
		     <if test='bankCode != null and !"".equals(bankCode)'>		    
			<![CDATA[
			and 	bank_code like concat('%',#{bankCode},'%') 
			]]>
			</if>
			<if test='expDate != null and !"".equals(expDate)'>
			<![CDATA[
			and 	date_format(exp_date,'%Y-%m-%d') like concat('%',#{expDate},'%') 
			]]>
			</if>
	</select>
	<!-- select list -->
	<select id="selectAll" resultType="ldebtvo" parameterType="map">
	<![CDATA[
		select a.no as no,
			a.code as code,
		    a.name as name,
		    a.major_code as majorCode,
		    a.debt_amount as debtAmount,
		    a.repay_bal as repayBal,
		    a.repay_way as repayWay,
		    concat(date_format(a.debt_date,'%Y/%m/%d'),'-',
		    date_format(a.exp_date,'%Y/%m/%d')) as debtExpDate,
		    a.int_rate as intRate,
		    a.int_pay_way as intPayWay,
		    a.mgr,
		    a.mgr_call as mgrCall,
		    a.bank_code as bankCode,
		    a.deposit_no as depositNo,
		    b.name as bankName
		    from tb_l_term_debt as a,tb_bank as b
		    where a.bank_code=b.code
		    		and a.delete_flag="N"
		    ]]>
		  <if  test='vo.debtDate!=null and !"".equals(vo.debtDate)'>		    
			<![CDATA[
			and 	date_format(a.debt_date,'%Y-%m-%d') like concat('%',#{vo.debtDate},'%') 
			]]>
			</if>
			<if test='vo.intPayWay != null and !"".equals(vo.intPayWay)'>
			<![CDATA[
			and 	a.int_pay_way = #{vo.intPayWay}
			]]>
			</if>
		     <if test='vo.bankName != null and !"".equals(vo.bankName)'>		    
			<![CDATA[
			and 	b.name like concat('%',#{vo.bankName},'%') 
			]]>
			</if>
			<if test='vo.expDate != null and !"".equals(vo.expDate)'>
			<![CDATA[
			and 	a.date_format(exp_date,'%Y-%m-%d') like concat('%',#{vo.expDate},'%') 
			]]>
			</if>
			
			<if test='sort != null and "d".equals(sort)'>
			<![CDATA[
			order by debt_date desc
			]]>
			</if>
			<if test='sort != null and "e".equals(sort)'>
			<![CDATA[
			order by exp_date desc
			]]>
			</if>
		     <if test='sort != null and "i".equals(sort)'>		    
			<![CDATA[
			order by insert_date desc
			]]>
			</if>
			<if test='sort != null and "m".equals(sort)'>
			<![CDATA[
			order by debt_amount
			]]>
			</if>
			<if test="pagination.pageIndex >= 0">
            <![CDATA[
                limit    #{pagination.pageIndex }, #{pagination.listSize }
             ]]>
          </if>
	</select>
	<select id="selectsection" resultType="sectionvo">
	<![CDATA[
		select no,
			classification,
			code,
			
			last_update as lastUpdate,
			parent_no as parentNo
		    from tb_section
		    where parent_no= 6
	]]>
	
	</select>
</mapper>