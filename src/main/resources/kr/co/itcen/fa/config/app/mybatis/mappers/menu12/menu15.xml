<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="menu15">
	
	<insert id="save" parameterType="salescustomervo">
		<![CDATA[
		insert
		  into tb_salescustomer
		values (#{no }, concat('S', #{name }), #{ceo }, #{corporationNo }, #{zipCode }, #{address }, #{detailAddress }, #{phone }, #{conditions }, #{item }, 
				#{openDate }, #{jurisdictionOffice }, #{managerName }, #{managerEmail }, #{depositNo }, #{depositHost }, 
				#{insertUserid }, now(), null, null, 'N')
		]]>
	</insert>
	
	<select id="findAll" parameterType="string" resultType="salescustomervo">
		<![CDATA[
		select no, name, ceo, corporation_no as corporationNo, zip_code as zipCode, address, detail_address as detailAddress, 
			   concat(address, " (", zip_code, ")", " ", detail_address) as addressAll, phone, conditions, item, date_format(open_date, "%Y-%m-%d") as openDate,
		       jurisdiction_office as jurisdictionOffice, manager_name as managerName, manager_email as managerEmail,
		       deposit_no as depositNo, case when delete_flag = 'Y' then '삭제' when delete_flag = 'N' then '' end as deleteFlag, 
		       insert_userid as insertUserid, date_format(insert_day, "%Y-%m-%d %T") as insertDay,
		       update_userid as updateUserid, date_format(update_day, "%Y-%m-%d %T") as updateDay
		from tb_salescustomer
		]]>
		<if test="_parameter != '%%' ">
			<![CDATA[
			where no like #{_parameter }
			]]>	
		</if>
		<![CDATA[
		order by no
		]]>
	</select>
	
	<update id="update" parameterType="salescustomervo">
		<![CDATA[
		update tb_salescustomer
		set no=#{no }, name=#{name }, ceo=#{ceo }, corporation_no=#{corporationNo }, zip_code=#{zipCode }, address=#{address }, 
			detail_address=#{detailAddress }, phone=#{phone }, conditions=#{conditions }, item=#{item },
			open_date=#{openDate }, jurisdiction_office=#{jurisdictionOffice }, manager_name=#{managerName }, manager_email=#{managerEmail }, 
			deposit_no=#{depositNo }, deposit_host=#{depositHost }, update_userid=#{updateUserid }, update_day=now()
		where no = #{preNo }
		]]>
	</update>
	
	<select id="findByNo" parameterType="string" resultType="salescustomervo">
		select no
		from tb_salescustomer
		where no = #{_parameter }
	</select>
	
	<update id="deleteByNo" parameterType="list">
		<![CDATA[
		update tb_salescustomer 
		set delete_flag = 'Y'
		where no in
		]]>
		<foreach item="item" index="index" collection="list" open="(" close=")" separator="," >
	        #{item}
	  </foreach>
	</update>
</mapper>